# Redirect www â†’ root
www.daifend.ai {
    redir https://daifend.ai{uri} 308
}

# Main site
daifend.ai {
    encode zstd gzip

    # allow ACME challenges, block dotfiles and .env
    @wellknown path /.well-known/*
    @dotfiles path_regexp dotfiles (^|/)\.
    @not_wellknown not path /.well-known/*
    @envfiles path_regexp envfiles (?i)/\.?env(\.|$)
    respond @dotfiles @not_wellknown 404
    respond @envfiles 404

    reverse_proxy app:5000

    header {
        Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
        X-Content-Type-Options "nosniff"
        Referrer-Policy "no-referrer-when-downgrade"
        X-Frame-Options "DENY"
        X-XSS-Protection "1; mode=block"
        Cache-Control "public, max-age=3600"
    }

    log {
        output stdout
        format console
    }
}
